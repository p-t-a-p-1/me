---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import BlogCard from "../../components/BlogCard.astro";
import BlogSidebar from "../../components/BlogSidebar.astro";
import Pager from "../../components/Pager.astro";
import Layout from "../../layouts/Layout.astro";

// „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Åã„ÇâË®ò‰∫ã„ÇíÂèñÂæó
const allPosts = await getCollection("blog");

// ÂÖ¨ÈñãÊ∏à„Åø„ÅÆË®ò‰∫ã„ÅÆ„Åø„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åó„ÄÅÊó•‰ªòÈ†Ü„Å´„ÇΩ„Éº„Éà
const publishedPosts = allPosts
	.filter((post) => post.data.publishedAt)
	.sort((a, b) => {
		const dateA = new Date(a.data.publishedAt || 0);
		const dateB = new Date(b.data.publishedAt || 0);
		return dateB.getTime() - dateA.getTime();
	});

// Ë®ò‰∫ã„ÇíBlogCard„ÅßÂøÖË¶Å„Å™ÂΩ¢Âºè„Å´Â§âÊèõ
const blogs = publishedPosts.map((post) => ({
	title: post.data.title,
	emoji: { value: post.data.emoji || "üìù" },
	tags: post.data.tags || [],
	slug: post.slug,
	url: `/blog/${post.slug}`,
	thumbnail: post.data.thumbnail || "",
}));
---

<Layout title="BLOG">
	<main class="blog-list">
		<div class="blog-list__container">
			<div class="blog-list__content">
				<div class="blog-list__main">
					<div class="blog-list__grid">
						{
							blogs.map((blog) => (
								<BlogCard
									title={blog.title}
									emoji={blog.emoji.value}
									tags={blog.tags}
									slug={blog.slug}
									url={blog.url}
									thumbnail={blog.thumbnail}
								/>
							))
						}
					</div>
				</div>
			</div>
			<aside class="blog-list__sidebar">
				<BlogSidebar />
			</aside>
		</div>
	</main>
</Layout>

<style>
	.blog-list {
		padding: 40px 20px;
	}

	.blog-list__container {
		max-width: 1200px;
		margin: 0 auto;
		display: grid;
		grid-template-columns: 1fr 300px;
		gap: 40px;
	}

	.blog-list__content {
		overflow: hidden;
	}

	.blog-list__main {
		display: flex;
		flex-direction: column;
		gap: 40px;
	}

	.blog-list__grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
		gap: 20px;
	}

	.blog-list__sidebar {
		position: relative;
	}

	@media (max-width: 768px) {
		.blog-list {
			padding: 20px 10px;
		}

		.blog-list__container {
			grid-template-columns: 1fr;
			gap: 20px;
		}

		.blog-list__sidebar {
			order: -1;
		}

		.blog-list__main {
			gap: 20px;
		}

		.blog-list__grid {
			grid-template-columns: 1fr;
		}
	}
</style>
